FROM ollama/ollama:latest

# Add security labels
LABEL maintainer="DIE Development Team"
LABEL security.scan="enabled"
LABEL version="1.0.0"

# Install curl for health checks
RUN apt-get update && \
    apt-get install -y --no-install-recommends curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Note: Models are pulled at runtime via docker-compose volumes
# to avoid bloating the image size (~12GB)

# Health check with longer start period for model loading
HEALTHCHECK --interval=30s --timeout=10s --start-period=180s --retries=3 \
  CMD curl -f http://localhost:11434/api/tags || exit 1

# Expose Ollama port
EXPOSE 11434

# Use exec form for proper signal handling
CMD ["serve"]
